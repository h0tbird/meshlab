#!/usr/bin/env bash

# shellcheck source=/dev/null
source lib/common.sh

#------------------------------------------------------------------------------
# Delete clusters
#------------------------------------------------------------------------------

multipass suspend "${CLUS0}" "${CLUS1}" "${CLUS2}"
multipass delete "${CLUS0}" "${CLUS1}" "${CLUS2}"
multipass purge

#------------------------------------------------------------------------------
# Setup KUBECONFIG
#------------------------------------------------------------------------------

for CLUSTER in ${CLUS0} ${CLUS1} ${CLUS2}; do
  kubectl config delete-user "${CLUSTER}"
  kubectl config delete-cluster "${CLUSTER}"
  kubectl config delete-context "${CLUSTER}"
done

#------------------------------------------------------------------------------
# Delete ArgoCD context
#------------------------------------------------------------------------------

argocd context --delete "${CLUS0}"

#------------------------------------------------------------------------------
# Delete the istio-sidecar.deb
#------------------------------------------------------------------------------

rm -f ./tmp/virt-01/istio-sidecar.deb
